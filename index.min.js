import{marked as t}from"marked";const e={x:null,y:null,width:null,height:null,zIndex:null,id:null,class:[],markdown:"",html:""};export function parse(t,e=!0){const s=parseJson(t);let n="";return s.panes.forEach(t=>{const e=[];let s=!1;{let h=!1;function l(){h||(e.push("position:absolute;"),h=!0)}null!=t.x&&null!=t.x&&(e.push(`left:${t.x}px;`),l(),s=!0),null!=t.y&&null!=t.y&&(e.push(`top:${t.y}px;`),l(),s=!0)}null!=t.width&&null!=t.width&&e.push(`width:${t.width}px;`),null!=t.height&&null!=t.height&&(e.push(`height:${t.height}px;`),s=!0),null!=t.zIndex&&null!=t.zIndex&&(e.push(`z-index:${t.zIndex};`),s=!0);const i=(()=>{if(s){let t="";return e.forEach(e=>{t+=e}),` style="${t}"`}return""})(),r=null!=t.id&&null!=t.id?` id="${t.id}"`:"",a=(()=>{let e="";return t.class.length>0?(t.class.forEach(t=>{e+=t+" "}),` class="${e}"`):""})();n+=`<div${r}${a}${i}>\n${t.html}</div>\n`}),e?`<div style="position:relative;overflow:scroll;width:100%;height:100%;">\n${n}\n</div>`:n}export function parseJson(n){const l={panes:[]},i=n.split("\n");let r=null,a=[],h=[];function c(e){r.markdown=e.join("\n").trim(),r.html=t.parse(r.markdown),l.panes.push(structuredClone(r)),r=null}for(const t of i){const e=t.trim();e.startsWith("---")?r?c(a):(r=s(e.slice(3).trim()),a=[]):r?a.push(t):h.push(t)}return r&&c(a),r=structuredClone(e),c(h),l}function s(t){const s=structuredClone(e);{const e=t.trim();if(!e||""===e)return s}if(t.includes("="))for(const[,n,l]of t.matchAll(/(\w+(?:-\w+)?)=("[^"]*"|'[^']*'|[^\s"']+)/g)){let t=l;switch((t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(t=t.slice(1,-1)),n){case"x":s.x=parseInt(t)??e.x;break;case"y":s.y=parseInt(t)??e.y;break;case"w":case"width":s.width=parseInt(t)??e.width;break;case"h":case"height":s.height=parseInt(t)??e.height;break;case"z":case"z-index":s.zIndex=parseInt(t)??e.zIndex;break;case"id":s.id=t??e.id;break;case"class":s.class=t.split(/\s+/).filter(Boolean)??e.class}}else{const n=t.trim().split(/\s+/);for(let t=0;t<n.length;t++)switch(t){case 0:s.x=parseInt(n[t])??e.x;break;case 1:s.y=parseInt(n[t])??e.y;break;case 2:s.width=parseInt(n[t])??e.width;break;case 3:s.height=parseInt(n[t])??e.height;break;case 4:s.zIndex=parseInt(n[t])??e.zIndex;break;case 5:{const l=n.slice(t);for(let t=0;t<l.length;t++)0===t?s.id=l[0]??e.id:l[t]&&s.class.push(l[t])}}}return s}