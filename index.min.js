import{marked as e}from"marked";const t={x:null,y:null,width:null,height:null,zIndex:null,id:null,class:[],markdown:"",html:""};export function parseMdp(e,t=!0){const s=parseMdpJson(e);let n="";return s.panes.forEach(e=>{const t=[];let s=!1;{let h=!1;function l(){h||(t.push("position:absolute;"),h=!0)}null!=e.x&&null!=e.x&&(t.push(`left:${e.x}px;`),l(),s=!0),null!=e.y&&null!=e.y&&(t.push(`top:${e.y}px;`),l(),s=!0)}null!=e.width&&null!=e.width&&t.push(`width:${e.width}px;`),null!=e.height&&null!=e.height&&(t.push(`height:${e.height}px;`),s=!0),null!=e.zIndex&&null!=e.zIndex&&(t.push(`z-index:${e.zIndex};`),s=!0);const r=(()=>{if(s){let e="";return t.forEach(t=>{e+=t}),` style="${e}"`}return""})(),a=null!=e.id&&null!=e.id?` id="${e.id}"`:"",i=(()=>{let t="";return e.class.length>0?(e.class.forEach(e=>{t+=e+" "}),` class="${t}"`):""})();n+=`<div${a}${i}${r}>\n${e.html}</div>\n`}),t?`<div style="position:relative;overflow:scroll;width:100%;height:100%;">\n${n}\n</div>`:n}export function parseMdpJson(n){const l={panes:[]},r=n.split("\n");let a=null,i=[],h=[];function c(t){a.markdown=t.join("\n").trim(),a.html=e.parse(a.markdown),l.panes.push(structuredClone(a)),a=null}for(const e of r){const t=e.trim();t.startsWith("---")?a?c(i):(a=s(t.slice(3).trim()),i=[]):a?i.push(e):h.push(e)}return a&&c(i),a=structuredClone(t),c(h),l}function s(e){const s=structuredClone(t);{const t=e.trim();if(!t||""===t)return s}if(e.includes("="))for(const[,n,l]of e.matchAll(/(\w+(?:-\w+)?)=("[^"]*"|'[^']*'|[^\s"']+)/g)){let e=l;switch((e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))&&(e=e.slice(1,-1)),n){case"x":s.x=parseInt(e)??t.x;break;case"y":s.y=parseInt(e)??t.y;break;case"w":case"width":s.width=parseInt(e)??t.width;break;case"h":case"height":s.height=parseInt(e)??t.height;break;case"z":case"z-index":s.zIndex=parseInt(e)??t.zIndex;break;case"id":s.id=e??t.id;break;case"class":s.class=e.split(/\s+/).filter(Boolean)??t.class}}else{const n=e.trim().split(/\s+/);for(let e=0;e<n.length;e++)switch(e){case 0:s.x=parseInt(n[e])??t.x;break;case 1:s.y=parseInt(n[e])??t.y;break;case 2:s.width=parseInt(n[e])??t.width;break;case 3:s.height=parseInt(n[e])??t.height;break;case 4:s.zIndex=parseInt(n[e])??t.zIndex;break;case 5:{const l=n.slice(e);for(let e=0;e<l.length;e++)0===e?s.id=l[0]??t.id:l[e]&&s.class.push(l[e])}}}return s}export const markpane={parse:(e,t=!0)=>parseMdp(e,t),parseJson:e=>parseMdpJson(e)};export default markpane;